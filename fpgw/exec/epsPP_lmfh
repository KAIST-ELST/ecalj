#!/bin/tcsh 
### MPI version 
if($# != 3 |$argv[1] != "-np" ) then
  echo "  An example of usage: epsPP_lmfh -np 4 si"
  echo "  k paralell for lmfgw-MPIK and hx0fp0"
  exit
endif

set n = $0
set nfpgw = ${n:h}
set TARGET=$argv[3]
set MPI_SIZE=$argv[2]
echo "### START epsPP_lmfh: MPI size= " $MPI_SIZE, "TARGET= "$TARGET

######## THIS IS for no lfc mode. See hbasfp0 and hx0fp0 c2 case.
echo $nfpgw
echo $TARGET
setenv LMJOB $TARGET

rm -f NoCore QPU* >& /dev/null

### Get LATTC and SYMOPS
echo 0 |$nfpgw/lmfgw --novxc  $TARGET > llmfgw00

### Add  two q points (0.05 0 0 ) (0.1 0 0) to Q0P file.  -----------------
echo 2|$nfpgw/qg4gw  >lqg4gw02

#eigenvalues for micro-tetrahedron method.
if(-e Qmtet) then
  mv Qmtet Qeigval 
  echo 5 |mpirun -np $MPI_SIZE $nfpgw/lmfgw-MPIK --novxc  $TARGET > llmfgw_eigval
  mv eigval eigmtet
endif

echo 1 |mpirun -np $MPI_SIZE $nfpgw/lmfgw-MPIK --novxc  $TARGET > llmfgw01
#@ exinfo = `tail -3 llmfgw01 | head -1|awk '{print $2}'`
set exinfo = $?

if($exinfo == 0 ) then
  echo " OK! lmfgw mode=1 "
else
  echo Error in echo 1\|lmfgw $TARGET
  echo `tail -3 llmfgw01 `
  exit
endif

echo $TARGET|$nfpgw/lmf2gw   > llmf2gw
rm gwa.$TARGET gwb.$TARGET gw1.$TARGET gw2.$TARGET

echo 0|$nfpgw/rdata4gw_v2      >lrdata4gw
head -1000 VXCFP.chk >VXCFP.chk.head.log
rm VXCFP.chk;rm CphiGeig

# get EFERMI
echo 1|$nfpgw/heftet  >leftet

# mode 4 is for ptest !!!!!!!!!!
echo 4|$nfpgw/hbasfp0 >lbas
echo 202|mpirun -np $MPI_SIZE $nfpgw/hvccfp0 >lvcc	

echo 202|mpirun -np $MPI_SIZE $nfpgw/hx0fp0  >lx0
#mkdir EpsP$qqq
#mv lqg4gw lbas lvcc lx0 Q0P EPSnolfc* EpsP$qqq
 





 
